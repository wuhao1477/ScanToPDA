# ScanToPDA 版本更新系统使用说明

## 🎯 系统概述

本项目已成功集成了完整的版本更新系统，包括：
- **自动化CI/CD构建发布**
- **应用内OTA更新服务**
- **安全文件校验机制**
- **智能更新管理**

## 🚀 开发者发布流程

### 1. 准备发布新版本

1. **更新版本号**：
   ```yaml
   # pubspec.yaml
   version: 1.0.1+2  # 主版本.次版本.修订版本+构建号
   ```

2. **提交代码**：
   ```bash
   git add .
   git commit -m "feat: 新功能或修复说明"
   git push origin main
   ```

3. **创建并推送标签**：
   ```bash
   git tag v1.0.1
   git push origin v1.0.1
   ```

### 2. 自动化构建过程

推送标签后，GitHub Actions会自动：
1. ✅ 提取应用名称和版本号
2. ✅ 构建APK文件
3. ✅ 重命名为 `scan_to_pda-v1.0.1.apk`
4. ✅ 生成SHA256校验和
5. ✅ 创建GitHub Release
6. ✅ 上传APK和校验和文件

### 3. 手动构建（可选）

也可以通过GitHub Actions的手动触发：
1. 访问仓库的 **Actions** 标签页
2. 选择 **Build and Release ScanToPDA APK**
3. 点击 **Run workflow**
4. 配置参数并执行

## 📱 用户更新流程

### 自动检查更新

应用启动3秒后会自动进行静默更新检查：
- ✅ 检查网络连接
- ✅ 对比版本号
- ✅ 非阻塞式通知

### 手动检查更新

1. 打开应用
2. 进入 **设置** 页面
3. 点击 **检查更新**
4. 如有新版本，会显示更新对话框

### 更新过程

1. **版本对比**：自动比较当前版本与最新版本
2. **下载APK**：显示下载进度
3. **文件校验**：验证SHA256完整性
4. **安装引导**：自动打开APK安装程序

## ⚙️ 更新设置

### 访问更新设置

设置 → 更新设置

### 可配置选项

- **自动检查更新**：开启/关闭自动检查
- **检查频率**：1小时 - 7天可选
- **上次检查时间**：显示最后检查时间

### 高级功能

- **版本跳过**：可跳过特定版本
- **网络检测**：自动检测网络状态
- **静默检查**：后台自动检查不打扰用户

## 🔒 安全特性

### 文件完整性校验

- ✅ 每个APK都有SHA256校验和
- ✅ 下载后自动验证文件完整性
- ✅ 防止中间人攻击和文件篡改

### 权限管理

应用会自动处理以下权限：
- `INTERNET` - 网络访问
- `ACCESS_NETWORK_STATE` - 网络状态检测
- `REQUEST_INSTALL_PACKAGES` - APK安装权限

### 用户授权

首次安装APK时，Android系统会要求用户：
1. 允许"安装未知应用"权限
2. 确认APK安装

## 🛠️ 故障排除

### 常见问题

**Q: 检查更新失败**
A: 检查网络连接，确保能访问GitHub

**Q: 下载失败**
A: 检查存储空间和网络稳定性

**Q: 无法安装APK**
A: 在设置中允许"安装未知应用"权限

**Q: 校验失败**
A: 重新下载APK文件

### 网络要求

- ✅ 需要互联网连接
- ✅ 能够访问 `api.github.com`
- ✅ 能够下载GitHub Release资源

## 📊 版本管理最佳实践

### 语义化版本控制

遵循 `主版本.次版本.修订版本` 格式：
- **主版本**：不兼容的API修改
- **次版本**：向后兼容的功能新增
- **修订版本**：向后兼容的问题修正

### Git标签规范

- ✅ 使用 `v1.0.0` 格式
- ✅ 与pubspec.yaml版本保持同步
- ✅ 每个发布版本对应一个标签

### Release说明

GitHub Actions会自动生成包含以下信息的Release：
- 📝 版本号和应用名称
- 🔐 SHA256校验和
- 📥 安装说明
- ⚠️ 注意事项

## 🎉 系统优势

- **完全自动化**：推送标签即可发布
- **用户友好**：应用内直接更新
- **安全可靠**：文件完整性校验
- **智能管理**：自定义更新策略
- **零成本**：基于GitHub免费服务

---

**系统已完全就绪，可立即投入使用！** 🚀
